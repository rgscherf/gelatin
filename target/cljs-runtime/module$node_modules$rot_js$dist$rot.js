shadow$provide.module$node_modules$rot_js$dist$rot=function(global,process,require,module,exports,shadow$shims){function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;subClass.__proto__=superClass}(function(global,factory){"object"===typeof exports&&"undefined"!==
typeof module?factory(exports):"function"===typeof define&&define.amd?define(["exports"],factory):factory(global.ROT={})})(this,function(exports){function mod(x,n){return(x%n+n)%n}function clamp(val,min,max){void 0===min&&(min=0);void 0===max&&(max=1);return val<min?min:val>max?max:val}function capitalize(string){return string.charAt(0).toUpperCase()+string.substring(1)}function format(template){for(var _len=arguments.length,args=Array(1<_len?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];
var map=format.map;return template.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,function(match,group1,group2,index){if("%"==template.charAt(index-1))return match.substring(1);if(!args.length)return match;group2=(group1||group2).split(",");group1=group2.shift()||"";index=map[group1.toLowerCase()];if(!index)return match;match=args.shift();match=match[index].apply(match,group2);group1=group1.charAt(0);group1!=group1.toLowerCase()&&(match=capitalize(match));return match})}function fromString(str){var r;if(str in
CACHE)var cached=CACHE[str];else{if("#"==str.charAt(0))if(cached=(str.match(/[0-9a-f]/gi)||[]).map(function(x){return parseInt(x,16)}),3==cached.length)cached=cached.map(function(x){return 17*x});else for(r=0;3>r;r++)cached[r+1]+=16*cached[r],cached.splice(r,1);else cached=(r=str.match(/rgb\(([0-9, ]+)\)/i))?r[1].split(/\s*,\s*/).map(function(x){return parseInt(x)}):[0,0,0];CACHE[str]=cached}return cached.slice()}function add_(color1){for(var _len3=arguments.length,colors=Array(1<_len3?_len3-1:0),
_key3=1;_key3<_len3;_key3++)colors[_key3-1]=arguments[_key3];for(_len3=0;3>_len3;_len3++)for(_key3=0;_key3<colors.length;_key3++)color1[_len3]+=colors[_key3][_len3];return color1}function interpolate(color1,color2,factor){void 0===factor&&(factor=.5);for(var result=color1.slice(),i=0;3>i;i++)result[i]=Math.round(result[i]+factor*(color2[i]-color1[i]));return result}function interpolateHSL(color1,color2,factor){void 0===factor&&(factor=.5);color1=rgb2hsl(color1);color2=rgb2hsl(color2);for(var i=0;3>
i;i++)color1[i]+=factor*(color2[i]-color1[i]);return hsl2rgb(color1)}function rgb2hsl(color){var r=color[0]/255,g=color[1]/255;color=color[2]/255;var max=Math.max(r,g,color),min=Math.min(r,g,color),h=0,l=(max+min)/2;if(max==min)min=0;else{var d=max-min;min=.5<l?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-color)/d+(g<color?6:0);break;case g:h=(color-r)/d+2;break;case color:h=(r-g)/d+4}h/=6}return[h,min,l]}function hue2rgb(p,q,t){0>t&&(t+=1);1<t&&--t;return t<1/6?p+6*(q-p)*t:.5>t?q:t<2/3?p+(q-
p)*(2/3-t)*6:p}function hsl2rgb(color){var l=color[2];if(0==color[1])return l=Math.round(255*l),[l,l,l];var s=color[1];s=.5>l?l*(1+s):l+s-l*s;var p=2*l-s;l=hue2rgb(p,s,color[0]+1/3);var g=hue2rgb(p,s,color[0]);color=hue2rgb(p,s,color[0]-1/3);return[Math.round(255*l),Math.round(255*g),Math.round(255*color)]}function createProgram(gl,vss,fss){var vs=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vs,vss);gl.compileShader(vs);if(!gl.getShaderParameter(vs,gl.COMPILE_STATUS))throw Error(gl.getShaderInfoLog(vs)||
"");vss=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(vss,fss);gl.compileShader(vss);if(!gl.getShaderParameter(vss,gl.COMPILE_STATUS))throw Error(gl.getShaderInfoLog(vss)||"");fss=gl.createProgram();gl.attachShader(fss,vs);gl.attachShader(fss,vss);gl.linkProgram(fss);if(!gl.getProgramParameter(fss,gl.LINK_STATUS))throw Error(gl.getProgramInfoLog(fss)||"");return fss}function createQuad(gl){var pos=new Float32Array([0,0,1,0,0,1,1,1]),buf=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buf);gl.bufferData(gl.ARRAY_BUFFER,
pos,gl.STATIC_DRAW);gl.enableVertexAttribArray(0);gl.vertexAttribPointer(0,2,gl.FLOAT,!1,0,0)}function parseColor(color){if(!(color in colorCache)){if("transparent"==color)var parsed=[0,0,0,0];else if(-1<color.indexOf("rgba")){parsed=(color.match(/[\d.]+/g)||[]).map(Number);for(var i=0;3>i;i++)parsed[i]/=255}else parsed=fromString(color).map(function($){return $/255}),parsed.push(1);colorCache[color]=parsed}return colorCache[color]}function termcolor(color){color=fromString(color);return 36*Math.floor(.0234375*
color[0])+6*Math.floor(.0234375*color[1])+1*Math.floor(.0234375*color[2])+16}function tokenize(str,maxWidth){var result=[],offset=0;str.replace(RE_COLORS,function(match,type,name,index){var part=str.substring(offset,index);part.length&&result.push({type:0,value:part});result.push({type:"c"==type?2:3,value:name.trim()});offset=index+match.length;return""});var part=str.substring(offset);part.length&&result.push({type:0,value:part});return breakLines(result,maxWidth)}function breakLines(tokens,maxWidth){maxWidth||
(maxWidth=Infinity);for(var i=0,lineLength=0,lastTokenWithSpace=-1;i<tokens.length;){var token=tokens[i];1==token.type&&(lineLength=0,lastTokenWithSpace=-1);if(0!=token.type)i++;else{for(;0==lineLength&&" "==token.value.charAt(0);)token.value=token.value.substring(1);var _index2=token.value.indexOf("\n");if(-1!=_index2){token.value=breakInsideToken(tokens,i,_index2,!0);for(_index2=token.value.split("");_index2.length&&" "==_index2[_index2.length-1];)_index2.pop();token.value=_index2.join("")}if(token.value.length){if(lineLength+
token.value.length>maxWidth){for(_index2=-1;;){var nextIndex=token.value.indexOf(" ",_index2+1);if(-1==nextIndex)break;if(lineLength+nextIndex>maxWidth)break;_index2=nextIndex}-1!=_index2?token.value=breakInsideToken(tokens,i,_index2,!0):-1!=lastTokenWithSpace?(i=tokens[lastTokenWithSpace],token=i.value.lastIndexOf(" "),i.value=breakInsideToken(tokens,lastTokenWithSpace,token,!0),i=lastTokenWithSpace):token.value=breakInsideToken(tokens,i,maxWidth-lineLength,!1)}else lineLength+=token.value.length,
-1!=token.value.indexOf(" ")&&(lastTokenWithSpace=i);i++}else tokens.splice(i,1)}}tokens.push({type:1});maxWidth=null;for(lineLength=0;lineLength<tokens.length;lineLength++)switch(lastTokenWithSpace=tokens[lineLength],lastTokenWithSpace.type){case 0:maxWidth=lastTokenWithSpace;break;case 1:if(maxWidth){for(lastTokenWithSpace=maxWidth.value.split("");lastTokenWithSpace.length&&" "==lastTokenWithSpace[lastTokenWithSpace.length-1];)lastTokenWithSpace.pop();maxWidth.value=lastTokenWithSpace.join("")}maxWidth=
null}tokens.pop();return tokens}function breakInsideToken(tokens,tokenIndex,breakIndex,removeBreakChar){removeBreakChar={type:0,value:tokens[tokenIndex].value.substring(breakIndex+(removeBreakChar?1:0))};tokens.splice(tokenIndex+1,0,{type:1},removeBreakChar);return tokens[tokenIndex].value.substring(0,breakIndex)}function addToList(i,L,R){R[L[i+1]]=R[i];L[R[i]]=L[i+1];R[i]=i+1;L[i+1]=i}function removeFromList(i,L,R){R[L[i]]=R[i];L[R[i]]=L[i];R[i]=i;L[i]=i}var RNG$1=(new (function(){function RNG(){this._c=
this._s2=this._s1=this._s0=this._seed=0}var _proto=RNG.prototype;_proto.getSeed=function(){return this._seed};_proto.setSeed=function(seed){this._seed=seed=1>seed?1/seed:seed;this._s0=2.3283064365386963E-10*(seed>>>0);seed=69069*seed+1>>>0;this._s1=2.3283064365386963E-10*seed;this._s2=2.3283064365386963E-10*(69069*seed+1>>>0);this._c=1;return this};_proto.getUniform=function(){var t=2091639*this._s0+2.3283064365386963E-10*this._c;this._s0=this._s1;this._s1=this._s2;this._c=t|0;return this._s2=t-this._c};
_proto.getUniformInt=function(lowerBound,upperBound){var max=Math.max(lowerBound,upperBound);lowerBound=Math.min(lowerBound,upperBound);return Math.floor(this.getUniform()*(max-lowerBound+1))+lowerBound};_proto.getNormal=function(mean,stddev){void 0===mean&&(mean=0);void 0===stddev&&(stddev=1);do{var u=2*this.getUniform()-1;var v=2*this.getUniform()-1;v=u*u+v*v}while(1<v||0==v);return mean+u*Math.sqrt(-2*Math.log(v)/v)*stddev};_proto.getPercentage=function(){return 1+Math.floor(100*this.getUniform())};
_proto.getItem=function(array){return array.length?array[Math.floor(this.getUniform()*array.length)]:null};_proto.shuffle=function(array){var result=[];for(array=array.slice();array.length;){var _index=array.indexOf(this.getItem(array));result.push(array.splice(_index,1)[0])}return result};_proto.getWeightedValue=function(data){var total=0;for(_id in data)total+=data[_id];total*=this.getUniform();var id;var _id=0;for(id in data)if(_id+=data[id],total<_id)break;return id};_proto.getState=function(){return[this._s0,
this._s1,this._s2,this._c]};_proto.setState=function(state){this._s0=state[0];this._s1=state[1];this._s2=state[2];this._c=state[3];return this};_proto.clone=function(){return(new RNG).setState(this.getState())};return RNG}())).setSeed(Date.now()),Backend=function(){function Backend(){}var _proto2=Backend.prototype;_proto2.getContainer=function(){return null};_proto2.setOptions=function(options){this._options=options};return Backend}(),Canvas=function(_Backend){function Canvas(){var _this=_Backend.call(this)||
this;_this._ctx=document.createElement("canvas").getContext("2d");return _this}_inheritsLoose(Canvas,_Backend);var _proto3=Canvas.prototype;_proto3.schedule=function(cb){requestAnimationFrame(cb)};_proto3.getContainer=function(){return this._ctx.canvas};_proto3.setOptions=function(opts){_Backend.prototype.setOptions.call(this,opts);opts=(opts.fontStyle?opts.fontStyle+" ":"")+" "+opts.fontSize+"px "+opts.fontFamily;this._ctx.font=opts;this._updateSize();this._ctx.font=opts;this._ctx.textAlign="center";
this._ctx.textBaseline="middle"};_proto3.clear=function(){this._ctx.fillStyle=this._options.bg;this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)};_proto3.eventToPosition=function(x,y){var canvas=this._ctx.canvas,rect=canvas.getBoundingClientRect();x-=rect.left;y-=rect.top;x*=canvas.width/rect.width;y*=canvas.height/rect.height;return 0>x||0>y||x>=canvas.width||y>=canvas.height?[-1,-1]:this._normalizedEventToPosition(x,y)};return Canvas}(Backend);format.map={s:"toString"};var util=
Object.freeze({mod:mod,clamp:clamp,capitalize:capitalize,format:format}),Hex=function(_Canvas){function Hex(){var _this2=_Canvas.call(this)||this;_this2._spacingX=0;_this2._spacingY=0;_this2._hexSize=0;return _this2}_inheritsLoose(Hex,_Canvas);var _proto4=Hex.prototype;_proto4.draw=function(data,clearBefore){var ch=data[2],fg=data[3],bg=data[4];data=[(data[0]+1)*this._spacingX,data[1]*this._spacingY+this._hexSize];this._options.transpose&&data.reverse();clearBefore&&(this._ctx.fillStyle=bg,this._fill(data[0],
data[1]));if(ch)for(this._ctx.fillStyle=fg,clearBefore=[].concat(ch),ch=0;ch<clearBefore.length;ch++)this._ctx.fillText(clearBefore[ch],data[0],Math.ceil(data[1]))};_proto4.computeSize=function(availWidth,availHeight){this._options.transpose&&(availWidth+=availHeight,availHeight=availWidth-availHeight,availWidth-=availHeight);return[Math.floor(availWidth/this._spacingX)-1,Math.floor((availHeight-2*this._hexSize)/this._spacingY+1)]};_proto4.computeFontSize=function(availWidth,availHeight){this._options.transpose&&
(availWidth+=availHeight,availHeight=availWidth-availHeight,availWidth-=availHeight);availWidth=Math.min(2*availWidth/((this._options.width+1)*Math.sqrt(3))-1,availHeight/(2+1.5*(this._options.height-1)));availHeight=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;var width=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=availHeight;availWidth=Math.floor(availWidth)+1;return Math.ceil(2*availWidth/(this._options.spacing*(1+width/100/Math.sqrt(3))))-1};_proto4._normalizedEventToPosition=
function(x,y){if(this._options.transpose){x+=y;y=x-y;x-=y;var nodeSize=this._ctx.canvas.width}else nodeSize=this._ctx.canvas.height;y=Math.floor(y/(nodeSize/this._options.height));mod(y,2)?(x-=this._spacingX,x=1+2*Math.floor(x/(2*this._spacingX))):x=2*Math.floor(x/(2*this._spacingX));return[x,y]};_proto4._fill=function(cx,cy){var a=this._hexSize,b=this._options.border,ctx=this._ctx;ctx.beginPath();this._options.transpose?(ctx.moveTo(cx-a+b,cy),ctx.lineTo(cx-a/2+b,cy+this._spacingX-b),ctx.lineTo(cx+
a/2-b,cy+this._spacingX-b),ctx.lineTo(cx+a-b,cy),ctx.lineTo(cx+a/2-b,cy-this._spacingX+b),ctx.lineTo(cx-a/2+b,cy-this._spacingX+b),ctx.lineTo(cx-a+b,cy)):(ctx.moveTo(cx,cy-a+b),ctx.lineTo(cx+this._spacingX-b,cy-a/2+b),ctx.lineTo(cx+this._spacingX-b,cy+a/2-b),ctx.lineTo(cx,cy+a-b),ctx.lineTo(cx-this._spacingX+b,cy+a/2-b),ctx.lineTo(cx-this._spacingX+b,cy-a/2+b),ctx.lineTo(cx,cy-a+b));ctx.fill()};_proto4._updateSize=function(){var opts=this._options,charWidth=Math.ceil(this._ctx.measureText("W").width);
this._hexSize=Math.floor(opts.spacing*(opts.fontSize+charWidth/Math.sqrt(3))/2);this._spacingX=this._hexSize*Math.sqrt(3)/2;this._spacingY=1.5*this._hexSize;if(opts.transpose){charWidth="height";var yprop="width"}else charWidth="width",yprop="height";this._ctx.canvas[charWidth]=Math.ceil((opts.width+1)*this._spacingX);this._ctx.canvas[yprop]=Math.ceil((opts.height-1)*this._spacingY+2*this._hexSize)};return Hex}(Canvas),Rect$jscomp$0=function(_Canvas2){function Rect(){var _this3=_Canvas2.call(this)||
this;_this3._spacingX=0;_this3._spacingY=0;_this3._canvasCache={};return _this3}_inheritsLoose(Rect,_Canvas2);var _proto5=Rect.prototype;_proto5.setOptions=function(options){_Canvas2.prototype.setOptions.call(this,options);this._canvasCache={}};_proto5.draw=function(data,clearBefore){Rect.cache?this._drawWithCache(data):this._drawNoCache(data,clearBefore)};_proto5._drawWithCache=function(data){var x=data[0],y=data[1],ch=data[2],fg=data[3],bg=data[4];data=""+ch+fg+bg;if(data in this._canvasCache)var canvas=
this._canvasCache[data];else{var b=this._options.border;canvas=document.createElement("canvas");var ctx=canvas.getContext("2d");canvas.width=this._spacingX;canvas.height=this._spacingY;ctx.fillStyle=bg;ctx.fillRect(b,b,canvas.width-b,canvas.height-b);if(ch)for(ctx.fillStyle=fg,ctx.font=this._ctx.font,ctx.textAlign="center",ctx.textBaseline="middle",ch=[].concat(ch),fg=0;fg<ch.length;fg++)ctx.fillText(ch[fg],this._spacingX/2,Math.ceil(this._spacingY/2));this._canvasCache[data]=canvas}this._ctx.drawImage(canvas,
x*this._spacingX,y*this._spacingY)};_proto5._drawNoCache=function(data,clearBefore){var x=data[0],y=data[1],ch=data[2],fg=data[3];data=data[4];clearBefore&&(clearBefore=this._options.border,this._ctx.fillStyle=data,this._ctx.fillRect(x*this._spacingX+clearBefore,y*this._spacingY+clearBefore,this._spacingX-clearBefore,this._spacingY-clearBefore));if(ch)for(this._ctx.fillStyle=fg,ch=[].concat(ch),fg=0;fg<ch.length;fg++)this._ctx.fillText(ch[fg],(x+.5)*this._spacingX,Math.ceil((y+.5)*this._spacingY))};
_proto5.computeSize=function(availWidth,availHeight){return[Math.floor(availWidth/this._spacingX),Math.floor(availHeight/this._spacingY)]};_proto5.computeFontSize=function(availWidth,availHeight){availWidth=Math.floor(availWidth/this._options.width);availHeight=Math.floor(availHeight/this._options.height);var oldFont=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;var width=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=oldFont;availWidth=width/100*availHeight/availWidth;
1<availWidth&&(availHeight=Math.floor(availHeight/availWidth));return Math.floor(availHeight/this._options.spacing)};_proto5._normalizedEventToPosition=function(x,y){return[Math.floor(x/this._spacingX),Math.floor(y/this._spacingY)]};_proto5._updateSize=function(){var opts=this._options,charWidth=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(opts.spacing*charWidth);this._spacingY=Math.ceil(opts.spacing*opts.fontSize);opts.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,
this._spacingY));this._ctx.canvas.width=opts.width*this._spacingX;this._ctx.canvas.height=opts.height*this._spacingY};return Rect}(Canvas);Rect$jscomp$0.cache=!1;var Tile=function(_Canvas3){function Tile(){var _this4=_Canvas3.call(this)||this;_this4._colorCanvas=document.createElement("canvas");return _this4}_inheritsLoose(Tile,_Canvas3);var _proto6=Tile.prototype;_proto6.draw=function(data,clearBefore){var x=data[0],y=data[1],ch=data[2],fg=data[3],bg=data[4];data=this._options.tileWidth;var tileHeight=
this._options.tileHeight;clearBefore&&(this._options.tileColorize?this._ctx.clearRect(x*data,y*tileHeight,data,tileHeight):(this._ctx.fillStyle=bg,this._ctx.fillRect(x*data,y*tileHeight,data,tileHeight)));if(ch)for(clearBefore=[].concat(ch),fg=[].concat(fg),bg=[].concat(bg),ch=0;ch<clearBefore.length;ch++){var tile=this._options.tileMap[clearBefore[ch]];if(!tile)throw Error('Char "'+clearBefore[ch]+'" not found in tileMap');if(this._options.tileColorize){var canvas=this._colorCanvas,context=canvas.getContext("2d");
context.globalCompositeOperation="source-over";context.clearRect(0,0,data,tileHeight);var _fg=fg[ch],_bg=bg[ch];context.drawImage(this._options.tileSet,tile[0],tile[1],data,tileHeight,0,0,data,tileHeight);"transparent"!=_fg&&(context.fillStyle=_fg,context.globalCompositeOperation="source-atop",context.fillRect(0,0,data,tileHeight));"transparent"!=_bg&&(context.fillStyle=_bg,context.globalCompositeOperation="destination-over",context.fillRect(0,0,data,tileHeight));this._ctx.drawImage(canvas,x*data,
y*tileHeight,data,tileHeight)}else this._ctx.drawImage(this._options.tileSet,tile[0],tile[1],data,tileHeight,x*data,y*tileHeight,data,tileHeight)}};_proto6.computeSize=function(availWidth,availHeight){return[Math.floor(availWidth/this._options.tileWidth),Math.floor(availHeight/this._options.tileHeight)]};_proto6.computeFontSize=function(){throw Error("Tile backend does not understand font size");};_proto6._normalizedEventToPosition=function(x,y){return[Math.floor(x/this._options.tileWidth),Math.floor(y/
this._options.tileHeight)]};_proto6._updateSize=function(){var opts=this._options;this._ctx.canvas.width=opts.width*opts.tileWidth;this._ctx.canvas.height=opts.height*opts.tileHeight;this._colorCanvas.width=opts.tileWidth;this._colorCanvas.height=opts.tileHeight};return Tile}(Canvas),CACHE={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,
250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,
205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,
0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,
143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,
232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,
105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,
255,224],ivory:[255,255,240],white:[255,255,255]};Canvas=Object.freeze({fromString:fromString,add:function(color1){for(var result=color1.slice(),_len2=arguments.length,colors=Array(1<_len2?_len2-1:0),_key2=1;_key2<_len2;_key2++)colors[_key2-1]=arguments[_key2];for(_len2=0;3>_len2;_len2++)for(_key2=0;_key2<colors.length;_key2++)result[_len2]+=colors[_key2][_len2];return result},add_:add_,multiply:function(color1){for(var result=color1.slice(),_len4=arguments.length,colors=Array(1<_len4?_len4-1:0),
_key4=1;_key4<_len4;_key4++)colors[_key4-1]=arguments[_key4];for(_len4=0;3>_len4;_len4++){for(_key4=0;_key4<colors.length;_key4++)result[_len4]*=colors[_key4][_len4]/255;result[_len4]=Math.round(result[_len4])}return result},multiply_:function(color1){for(var _len5=arguments.length,colors=Array(1<_len5?_len5-1:0),_key5=1;_key5<_len5;_key5++)colors[_key5-1]=arguments[_key5];for(_len5=0;3>_len5;_len5++){for(_key5=0;_key5<colors.length;_key5++)color1[_len5]*=colors[_key5][_len5]/255;color1[_len5]=Math.round(color1[_len5])}return color1},
interpolate:interpolate,lerp:interpolate,interpolateHSL:interpolateHSL,lerpHSL:interpolateHSL,randomize:function(color,diff){diff instanceof Array||(diff=Math.round(RNG$1.getNormal(0,diff)));color=color.slice();for(var i=0;3>i;i++)color[i]+=diff instanceof Array?Math.round(RNG$1.getNormal(0,diff[i])):diff;return color},rgb2hsl:rgb2hsl,hsl2rgb:hsl2rgb,toRGB:function(color){return"rgb("+color.map(function(x){return clamp(x,0,255)}).join(",")+")"},toHex:function(color){return"#"+color.map(function(x){return clamp(x,
0,255).toString(16).padStart(2,"0")}).join("")}});var TileGL=function(_Backend2){function TileGL(){var _this5=_Backend2.call(this)||this;_this5._uniforms={};try{_this5._gl=_this5._initWebGL()}catch(e){alert(e.message)}return _this5}_inheritsLoose(TileGL,_Backend2);TileGL.isSupported=function(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})};var _proto7=TileGL.prototype;_proto7.schedule=function(cb){requestAnimationFrame(cb)};_proto7.getContainer=function(){return this._gl.canvas};
_proto7.setOptions=function(opts){var _this6=this;_Backend2.prototype.setOptions.call(this,opts);this._updateSize();var tileSet=this._options.tileSet;tileSet&&"complete"in tileSet&&!tileSet.complete?tileSet.addEventListener("load",function(){return _this6._updateTexture(tileSet)}):this._updateTexture(tileSet)};_proto7.draw=function(data,clearBefore){var gl=this._gl,opts=this._options,x=data[0],y=data[1],ch=data[2],fg=data[3];data=data[4];gl.scissor(x*opts.tileWidth,gl.canvas.height-(y+1)*opts.tileHeight,
opts.tileWidth,opts.tileHeight);clearBefore&&(opts.tileColorize?gl.clearColor(0,0,0,0):gl.clearColor.apply(gl,parseColor(data)),gl.clear(gl.COLOR_BUFFER_BIT));if(ch)for(clearBefore=[].concat(ch),ch=[].concat(data),fg=[].concat(fg),gl.uniform2fv(this._uniforms.targetPosRel,[x,y]),x=0;x<clearBefore.length;x++){y=this._options.tileMap[clearBefore[x]];if(!y)throw Error('Char "'+clearBefore[x]+'" not found in tileMap');gl.uniform1f(this._uniforms.colorize,opts.tileColorize?1:0);gl.uniform2fv(this._uniforms.tilesetPosAbs,
y);opts.tileColorize&&(gl.uniform4fv(this._uniforms.tint,parseColor(fg[x])),gl.uniform4fv(this._uniforms.bg,parseColor(ch[x])));gl.drawArrays(gl.TRIANGLE_STRIP,0,4)}};_proto7.clear=function(){var gl=this._gl;gl.clearColor.apply(gl,parseColor(this._options.bg));gl.scissor(0,0,gl.canvas.width,gl.canvas.height);gl.clear(gl.COLOR_BUFFER_BIT)};_proto7.computeSize=function(availWidth,availHeight){return[Math.floor(availWidth/this._options.tileWidth),Math.floor(availHeight/this._options.tileHeight)]};_proto7.computeFontSize=
function(){throw Error("Tile backend does not understand font size");};_proto7.eventToPosition=function(x,y){var canvas=this._gl.canvas,rect=canvas.getBoundingClientRect();x-=rect.left;y-=rect.top;x*=canvas.width/rect.width;y*=canvas.height/rect.height;return 0>x||0>y||x>=canvas.width||y>=canvas.height?[-1,-1]:this._normalizedEventToPosition(x,y)};_proto7._initWebGL=function(){var _this7=this,gl=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=gl;var program=
createProgram(gl,VS,FS);gl.useProgram(program);createQuad(gl);UNIFORMS.forEach(function(name){return _this7._uniforms[name]=gl.getUniformLocation(program,name)});this._program=program;gl.enable(gl.BLEND);gl.blendFuncSeparate(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA);gl.enable(gl.SCISSOR_TEST);return gl};_proto7._normalizedEventToPosition=function(x,y){return[Math.floor(x/this._options.tileWidth),Math.floor(y/this._options.tileHeight)]};_proto7._updateSize=function(){var gl=
this._gl,opts=this._options,canvasSize=[opts.width*opts.tileWidth,opts.height*opts.tileHeight];gl.canvas.width=canvasSize[0];gl.canvas.height=canvasSize[1];gl.viewport(0,0,canvasSize[0],canvasSize[1]);gl.uniform2fv(this._uniforms.tileSize,[opts.tileWidth,opts.tileHeight]);gl.uniform2fv(this._uniforms.targetSize,canvasSize)};_proto7._updateTexture=function(tileSet){var gl=this._gl,t=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,t);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);
gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT);gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,0);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,tileSet)};return TileGL}(Backend),UNIFORMS="targetPosRel tilesetPosAbs tileSize targetSize colorize bg tint".split(" "),VS="#version 300 es\n\nin vec2 tilePosRel;\nout vec2 tilesetPosPx;\n\nuniform vec2 tilesetPosAbs;\nuniform vec2 tileSize;\nuniform vec2 targetSize;\nuniform vec2 targetPosRel;\n\nvoid main() {\n\tvec2 targetPosPx \x3d (targetPosRel + tilePosRel) * tileSize;\n\tvec2 targetPosNdc \x3d ((targetPosPx / targetSize)-0.5)*2.0;\n\ttargetPosNdc.y *\x3d -1.0;\n\n\tgl_Position \x3d vec4(targetPosNdc, 0.0, 1.0);\n\ttilesetPosPx \x3d tilesetPosAbs + tilePosRel * tileSize;\n}",
FS="#version 300 es\nprecision highp float;\n\nin vec2 tilesetPosPx;\nout vec4 fragColor;\nuniform sampler2D image;\nuniform bool colorize;\nuniform vec4 bg;\nuniform vec4 tint;\n\nvoid main() {\n\tfragColor \x3d vec4(0, 0, 0, 1);\n\n\tvec4 texel \x3d texelFetch(image, ivec2(tilesetPosPx), 0);\n\n\tif (colorize) {\n\t\ttexel.rgb \x3d tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;\n\t\tfragColor.rgb \x3d texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;\n\t\tfragColor.a \x3d texel.a + (1.0-texel.a)*bg.a;\n\t} else {\n\t\tfragColor \x3d texel;\n\t}\n}",
colorCache={},Term=function(_Backend3){function Term(){var _this8=_Backend3.call(this)||this;_this8._offset=[0,0];_this8._cursor=[-1,-1];_this8._lastColor="";return _this8}_inheritsLoose(Term,_Backend3);var _proto8=Term.prototype;_proto8.schedule=function(cb){setTimeout(cb,1E3/60)};_proto8.setOptions=function(options){_Backend3.prototype.setOptions.call(this,options);var size=[options.width,options.height];this._offset=this.computeSize().map(function(val,index){return Math.floor((val-size[index])/
2)})};_proto8.clear=function(){process.stdout.write("[0;48;5;"+termcolor(this._options.bg)+"m[2J")};_proto8.draw=function(data,clearBefore){var ch=data[2],fg=data[3],bg=data[4],dx=this._offset[0]+data[0],dy=this._offset[1]+data[1];data=this.computeSize();if(!(0>dx||dx>=data[0]||0>dy||dy>=data[1])){if(dx!==this._cursor[0]||dy!==this._cursor[1])process.stdout.write("["+(dy+1)+";"+(dx+1)+"H"),this._cursor[0]=dx,this._cursor[1]=dy;clearBefore&&(ch||(ch=" "));ch&&(clearBefore="[0;38;5;"+termcolor(fg)+
";48;5;"+termcolor(bg)+"m",clearBefore!==this._lastColor&&(process.stdout.write(clearBefore),this._lastColor=clearBefore),ch=[].concat(ch),process.stdout.write(ch[0]),this._cursor[0]++,this._cursor[0]>=data[0]&&(this._cursor[0]=0,this._cursor[1]++))}};_proto8.computeFontSize=function(){throw Error("Terminal backend has no notion of font size");};_proto8.eventToPosition=function(x,y){return[x,y]};_proto8.computeSize=function(){return[process.stdout.columns,process.stdout.rows]};return Term}(Backend),
RE_COLORS=/%([bc]){([^}]*)}/g;Backend=Object.freeze({TYPE_TEXT:0,TYPE_NEWLINE:1,TYPE_FG:2,TYPE_BG:3,measure:function(str,maxWidth){var result={width:0,height:1};str=tokenize(str,maxWidth);for(var i=maxWidth=0;i<str.length;i++){var token=str[i];switch(token.type){case 0:maxWidth+=token.value.length;break;case 1:result.height++,result.width=Math.max(result.width,maxWidth),maxWidth=0}}result.width=Math.max(result.width,maxWidth);return result},tokenize:tokenize});var DIRS={4:[[0,-1],[1,0],[0,1],[-1,
0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},BACKENDS={hex:Hex,rect:Rect$jscomp$0,tile:Tile,"tile-gl":TileGL,term:Term},DEFAULT_OPTIONS={width:80,height:25,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1},Display=function(){function Display(options){void 0===options&&(options={});this._data=
{};this._dirty=!1;this._options={};options=Object.assign({},DEFAULT_OPTIONS,options);this.setOptions(options);this.DEBUG=this.DEBUG.bind(this);this._tick=this._tick.bind(this);this._backend.schedule(this._tick)}var _proto9=Display.prototype;_proto9.DEBUG=function(x,y,what){var colors=[this._options.bg,this._options.fg];this.draw(x,y,null,null,colors[what%colors.length])};_proto9.clear=function(){this._data={};this._dirty=!0};_proto9.setOptions=function(options){Object.assign(this._options,options);
if(options.width||options.height||options.fontSize||options.fontFamily||options.spacing||options.layout)options.layout&&(this._backend=new BACKENDS[options.layout]),this._backend.setOptions(this._options),this._dirty=!0;return this};_proto9.getOptions=function(){return this._options};_proto9.getContainer=function(){return this._backend.getContainer()};_proto9.computeSize=function(availWidth,availHeight){return this._backend.computeSize(availWidth,availHeight)};_proto9.computeFontSize=function(availWidth,
availHeight){return this._backend.computeFontSize(availWidth,availHeight)};_proto9.computeTileSize=function(availWidth,availHeight){return[Math.floor(availWidth/this._options.width),Math.floor(availHeight/this._options.height)]};_proto9.eventToPosition=function(e){if("touches"in e){var x=e.touches[0].clientX;e=e.touches[0].clientY}else x=e.clientX,e=e.clientY;return this._backend.eventToPosition(x,e)};_proto9.draw=function(x,y,ch,fg,bg){fg||(fg=this._options.fg);bg||(bg=this._options.bg);var key=
x+","+y;this._data[key]=[x,y,ch,fg,bg];!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[key]=!0)};_proto9.drawText=function(x,y,text,maxWidth){var fg=null,bg=null,cx=x,lines=1;maxWidth||(maxWidth=this._options.width-x);for(text=tokenize(text,maxWidth);text.length;)switch(maxWidth=text.shift(),maxWidth.type){case 0:for(var isSpace,isPrevSpace=!1,isFullWidth,isPrevFullWidth=!1,i=0;i<maxWidth.value.length;i++){isSpace=maxWidth.value.charCodeAt(i);var c=maxWidth.value.charAt(i);isFullWidth=
65280<isSpace&&65377>isSpace||65500<isSpace&&65512>isSpace||65518<isSpace;isSpace=32==c.charCodeAt(0)||12288==c.charCodeAt(0);!isPrevFullWidth||isFullWidth||isSpace||cx++;isFullWidth&&!isPrevSpace&&cx++;this.draw(cx++,y,c,fg,bg);isPrevSpace=isSpace;isPrevFullWidth=isFullWidth}break;case 2:fg=maxWidth.value||null;break;case 3:bg=maxWidth.value||null;break;case 1:cx=x,y++,lines++}return lines};_proto9._tick=function(){this._backend.schedule(this._tick);if(this._dirty){if(!0===this._dirty){this._backend.clear();
for(var id in this._data)this._draw(id,!1)}else for(var key in this._dirty)this._draw(key,!0);this._dirty=!1}};_proto9._draw=function(key,clearBefore){key=this._data[key];key[4]!=this._options.bg&&(clearBefore=!0);this._backend.draw(key,clearBefore)};return Display}();Display.Rect=Rect$jscomp$0;Display.Hex=Hex;Display.Tile=Tile;Display.TileGL=TileGL;Display.Term=Term;Hex=function(){function StringGenerator(options){this._options={words:!1,order:3,prior:.001};Object.assign(this._options,options);this._suffix=
this._boundary=String.fromCharCode(0);this._prefix=[];for(options=0;options<this._options.order;options++)this._prefix.push(this._boundary);this._priorValues={};this._priorValues[this._boundary]=this._options.prior;this._data={}}var _proto10=StringGenerator.prototype;_proto10.clear=function(){this._data={};this._priorValues={}};_proto10.generate=function(){for(var result=[this._sample(this._prefix)];result[result.length-1]!=this._boundary;)result.push(this._sample(result));return this._join(result.slice(0,
-1))};_proto10.observe=function(string){string=this._split(string);for(var i=0;i<string.length;i++)this._priorValues[string[i]]=this._options.prior;string=this._prefix.concat(string).concat(this._suffix);for(i=this._options.order;i<string.length;i++)for(var context=string.slice(i-this._options.order,i),event=string[i],j=0;j<context.length;j++){var subcontext=context.slice(j);this._observeEvent(subcontext,event)}};_proto10.getStats=function(){var parts=[],priorCount=Object.keys(this._priorValues).length;
priorCount--;parts.push("distinct samples: "+priorCount);priorCount=Object.keys(this._data).length;var eventCount=0,p;for(p in this._data)eventCount+=Object.keys(this._data[p]).length;parts.push("dictionary size (contexts): "+priorCount);parts.push("dictionary size (events): "+eventCount);return parts.join(", ")};_proto10._split=function(str){return str.split(this._options.words?/\s+/:"")};_proto10._join=function(arr){return arr.join(this._options.words?" ":"")};_proto10._observeEvent=function(context,
event){context=this._join(context);context in this._data||(this._data[context]={});context=this._data[context];event in context||(context[event]=0);context[event]++};_proto10._sample=function(context){context=this._backoff(context);context=this._join(context);context=this._data[context];var available={};if(this._options.prior){for(var event in this._priorValues)available[event]=this._priorValues[event];for(var _event in context)available[_event]+=context[_event]}else available=context;return RNG$1.getWeightedValue(available)};
_proto10._backoff=function(context){for(context.length>this._options.order?context=context.slice(-this._options.order):context.length<this._options.order&&(context=this._prefix.slice(0,this._options.order-context.length).concat(context));!(this._join(context)in this._data)&&0<context.length;)context=context.slice(1);return context};return StringGenerator}();var EventQueue=function(){function EventQueue(){this._time=0;this._events=[];this._eventTimes=[]}var _proto11=EventQueue.prototype;_proto11.getTime=
function(){return this._time};_proto11.clear=function(){this._events=[];this._eventTimes=[];return this};_proto11.add=function(event,time){for(var index=this._events.length,i=0;i<this._eventTimes.length;i++)if(this._eventTimes[i]>time){index=i;break}this._events.splice(index,0,event);this._eventTimes.splice(index,0,time)};_proto11.get=function(){if(!this._events.length)return null;var time=this._eventTimes.splice(0,1)[0];if(0<time){this._time+=time;for(var i=0;i<this._eventTimes.length;i++)this._eventTimes[i]-=
time}return this._events.splice(0,1)[0]};_proto11.getEventTime=function(event){event=this._events.indexOf(event);if(-1!=event)return this._eventTimes[event]};_proto11.remove=function(event){event=this._events.indexOf(event);if(-1==event)return!1;this._remove(event);return!0};_proto11._remove=function(index){this._events.splice(index,1);this._eventTimes.splice(index,1)};return EventQueue}();TileGL=function(){function Scheduler(){this._queue=new EventQueue;this._repeat=[];this._current=null}var _proto12=
Scheduler.prototype;_proto12.getTime=function(){return this._queue.getTime()};_proto12.add=function(item,repeat){repeat&&this._repeat.push(item);return this};_proto12.getTimeOf=function(item){return this._queue.getEventTime(item)};_proto12.clear=function(){this._queue.clear();this._repeat=[];this._current=null;return this};_proto12.remove=function(item){var result=this._queue.remove(item),index=this._repeat.indexOf(item);-1!=index&&this._repeat.splice(index,1);this._current==item&&(this._current=
null);return result};_proto12.next=function(){return this._current=this._queue.get()};return Scheduler}();Rect$jscomp$0=function(_Scheduler){function Simple(){return _Scheduler.apply(this,arguments)||this}_inheritsLoose(Simple,_Scheduler);var _proto13=Simple.prototype;_proto13.add=function(item,repeat){this._queue.add(item,0);return _Scheduler.prototype.add.call(this,item,repeat)};_proto13.next=function(){null!==this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,
0);return _Scheduler.prototype.next.call(this)};return Simple}(TileGL);Tile=function(_Scheduler2){function Speed(){return _Scheduler2.apply(this,arguments)||this}_inheritsLoose(Speed,_Scheduler2);var _proto14=Speed.prototype;_proto14.add=function(item,repeat,time){this._queue.add(item,void 0!==time?time:1/item.getSpeed());return _Scheduler2.prototype.add.call(this,item,repeat)};_proto14.next=function(){this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed());
return _Scheduler2.prototype.next.call(this)};return Speed}(TileGL);TileGL=function(_Scheduler3){function Action(){var _this9=_Scheduler3.call(this)||this;_this9._defaultDuration=1;_this9._duration=_this9._defaultDuration;return _this9}_inheritsLoose(Action,_Scheduler3);var _proto15=Action.prototype;_proto15.add=function(item,repeat,time){this._queue.add(item,time||this._defaultDuration);return _Scheduler3.prototype.add.call(this,item,repeat)};_proto15.clear=function(){this._duration=this._defaultDuration;
return _Scheduler3.prototype.clear.call(this)};_proto15.remove=function(item){item==this._current&&(this._duration=this._defaultDuration);return _Scheduler3.prototype.remove.call(this,item)};_proto15.next=function(){null!==this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration);return _Scheduler3.prototype.next.call(this)};_proto15.setDuration=function(time){this._current&&(this._duration=time);
return this};return Action}(TileGL);Rect$jscomp$0={Simple:Rect$jscomp$0,Speed:Tile,Action:TileGL};Term=function(){function FOV(lightPassesCallback,options){void 0===options&&(options={});this._lightPasses=lightPassesCallback;this._options=Object.assign({topology:8},options)}FOV.prototype._getCircle=function(cx,cy,r){var result=[];switch(this._options.topology){case 4:var countFactor=1;var startOffset=[0,1];var dirs=[DIRS[8][7],DIRS[8][1],DIRS[8][3],DIRS[8][5]];break;case 6:dirs=DIRS[6];countFactor=
1;startOffset=[-1,1];break;case 8:dirs=DIRS[4];countFactor=2;startOffset=[-1,1];break;default:throw Error("Incorrect topology for FOV computation");}cx+=startOffset[0]*r;cy+=startOffset[1]*r;for(startOffset=0;startOffset<dirs.length;startOffset++)for(var j=0;j<r*countFactor;j++)result.push([cx,cy]),cx+=dirs[startOffset][0],cy+=dirs[startOffset][1];return result};return FOV}();Tile=function(_FOV){function DiscreteShadowcasting(){return _FOV.apply(this,arguments)||this}_inheritsLoose(DiscreteShadowcasting,
_FOV);var _proto17=DiscreteShadowcasting.prototype;_proto17.compute=function(x,y,R,callback){callback(x,y,0,1);if(this._lightPasses(x,y))for(var DATA=[],A,B,cx,cy,blocks,r=1;r<=R;r++)for(var neighbors=this._getCircle(x,y,r),angle=360/neighbors.length,i=0;i<neighbors.length;i++)if(cx=neighbors[i][0],cy=neighbors[i][1],A=angle*(i-.5),B=A+angle,blocks=!this._lightPasses(cx,cy),this._visibleCoords(Math.floor(A),Math.ceil(B),blocks,DATA)&&callback(cx,cy,r,1),2==DATA.length&&0==DATA[0]&&360==DATA[1])return};
_proto17._visibleCoords=function(A,B,blocks,DATA){if(0>A)return B=this._visibleCoords(0,B,blocks,DATA),A=this._visibleCoords(360+A,360,blocks,DATA),B||A;for(var index=0;index<DATA.length&&DATA[index]<A;)index++;if(index==DATA.length)return blocks&&DATA.push(A,B),!0;var count=0;if(index%2){for(;index<DATA.length&&DATA[index]<B;)index++,count++;if(0==count)return!1;blocks&&(count%2?DATA.splice(index-count,count,B):DATA.splice(index-count,count))}else{for(;index<DATA.length&&DATA[index]<B;)index++,count++;
if(A==DATA[index-count]&&1==count)return!1;blocks&&(count%2?DATA.splice(index-count,count,A):DATA.splice(index-count,count,A,B))}return!0};return DiscreteShadowcasting}(Term);TileGL=function(_FOV2){function PreciseShadowcasting(){return _FOV2.apply(this,arguments)||this}_inheritsLoose(PreciseShadowcasting,_FOV2);var _proto18=PreciseShadowcasting.prototype;_proto18.compute=function(x,y,R,callback){callback(x,y,0,1);if(this._lightPasses(x,y))for(var SHADOWS=[],cx,cy,blocks,A1,A2,r=1;r<=R;r++)for(var neighbors=
this._getCircle(x,y,r),neighborCount=neighbors.length,i=0;i<neighborCount;i++)if(cx=neighbors[i][0],cy=neighbors[i][1],A1=[i?2*i-1:2*neighborCount-1,2*neighborCount],A2=[2*i+1,2*neighborCount],blocks=!this._lightPasses(cx,cy),(blocks=this._checkVisibility(A1,A2,blocks,SHADOWS))&&callback(cx,cy,r,blocks),2==SHADOWS.length&&0==SHADOWS[0][0]&&SHADOWS[1][0]==SHADOWS[1][1])return};_proto18._checkVisibility=function(A1,A2,blocks,SHADOWS){if(A1[0]>A2[0])return A1=this._checkVisibility(A1,[A1[1],A1[1]],blocks,
SHADOWS),A2=this._checkVisibility([0,1],A2,blocks,SHADOWS),(A1+A2)/2;for(var index1=0,edge1=!1;index1<SHADOWS.length;){var old=SHADOWS[index1];old=old[0]*A1[1]-A1[0]*old[1];if(0<=old){0!=old||index1%2||(edge1=!0);break}index1++}old=SHADOWS.length;for(var edge2=!1;old--;){var _old=SHADOWS[old];_old=A2[0]*_old[1]-_old[0]*A2[1];if(0<=_old){0==_old&&old%2&&(edge2=!0);break}}_old=!0;index1==old&&(edge1||edge2)?_old=!1:edge1&&edge2&&index1+1==old&&old%2?_old=!1:index1>old&&index1%2&&(_old=!1);if(!_old)return 0;
edge1=old-index1+1;if(edge1%2)index1%2?(old=SHADOWS[index1],old=(A2[0]*old[1]-old[0]*A2[1])/(old[1]*A2[1]),blocks&&SHADOWS.splice(index1,edge1,A2)):(old=SHADOWS[old],old=(old[0]*A1[1]-A1[0]*old[1])/(A1[1]*old[1]),blocks&&SHADOWS.splice(index1,edge1,A1));else if(index1%2)edge2=SHADOWS[index1],old=SHADOWS[old],old=(old[0]*edge2[1]-edge2[0]*old[1])/(edge2[1]*old[1]),blocks&&SHADOWS.splice(index1,edge1);else return blocks&&SHADOWS.splice(index1,edge1,A1,A2),1;return old/((A2[0]*A1[1]-A1[0]*A2[1])/(A1[1]*
A2[1]))};return PreciseShadowcasting}(Term);var OCTANTS=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]];Term=function(_FOV3){function RecursiveShadowcasting(){return _FOV3.apply(this,arguments)||this}_inheritsLoose(RecursiveShadowcasting,_FOV3);var _proto19=RecursiveShadowcasting.prototype;_proto19.compute=function(x,y,R,callback){callback(x,y,0,1);for(var i=0;i<OCTANTS.length;i++)this._renderOctant(x,y,OCTANTS[i],R,callback)};_proto19.compute180=function(x,
y,R,dir,callback){callback(x,y,0,1);var previousOctant=(dir-1+8)%8,nextOctant=(dir+1+8)%8;this._renderOctant(x,y,OCTANTS[(dir-2+8)%8],R,callback);this._renderOctant(x,y,OCTANTS[previousOctant],R,callback);this._renderOctant(x,y,OCTANTS[dir],R,callback);this._renderOctant(x,y,OCTANTS[nextOctant],R,callback)};_proto19.compute90=function(x,y,R,dir,callback){callback(x,y,0,1);var previousOctant=(dir-1+8)%8;this._renderOctant(x,y,OCTANTS[dir],R,callback);this._renderOctant(x,y,OCTANTS[previousOctant],
R,callback)};_proto19._renderOctant=function(x,y,octant,R,callback){this._castVisibility(x,y,1,1,0,R+1,octant[0],octant[1],octant[2],octant[3],callback)};_proto19._castVisibility=function(startX,startY,row,visSlopeStart,visSlopeEnd,radius,xx,xy,yx,yy,callback){if(!(visSlopeStart<visSlopeEnd))for(;row<=radius;row++){for(var dx=-row-1,dy=-row,blocked=!1,newStart=0;0>=dx;){dx+=1;var mapX=startX+dx*xx+dy*xy,mapY=startY+dx*yx+dy*yy,slopeStart=(dx-.5)/(dy+.5),slopeEnd=(dx+.5)/(dy-.5);if(!(slopeEnd>visSlopeStart)){if(slopeStart<
visSlopeEnd)break;dx*dx+dy*dy<radius*radius&&callback(mapX,mapY,row,1);blocked?this._lightPasses(mapX,mapY)?(blocked=!1,visSlopeStart=newStart):newStart=slopeEnd:!this._lightPasses(mapX,mapY)&&row<radius&&(blocked=!0,this._castVisibility(startX,startY,row+1,visSlopeStart,slopeStart,radius,xx,xy,yx,yy,callback),newStart=slopeEnd)}}if(blocked)break}};return RecursiveShadowcasting}(Term);Tile={DiscreteShadowcasting:Tile,PreciseShadowcasting:TileGL,RecursiveShadowcasting:Term};Term=function(){function Map(width,
height){void 0===width&&(width=80);void 0===height&&(height=25);this._width=width;this._height=height}Map.prototype._fillMap=function(value){for(var map=[],i=0;i<this._width;i++){map.push([]);for(var j=0;j<this._height;j++)map[i].push(value)}return map};return Map}();TileGL=function(_Map){function Arena(){return _Map.apply(this,arguments)||this}_inheritsLoose(Arena,_Map);Arena.prototype.create=function(callback){for(var w=this._width-1,h=this._height-1,i=0;i<=w;i++)for(var j=0;j<=h;j++)callback(i,
j,i&&j&&i<w&&j<h?0:1);return this};return Arena}(Term);var Dungeon=function(_Map2){function Dungeon(width,height){width=_Map2.call(this,width,height)||this;width._rooms=[];width._corridors=[];return width}_inheritsLoose(Dungeon,_Map2);var _proto22=Dungeon.prototype;_proto22.getRooms=function(){return this._rooms};_proto22.getCorridors=function(){return this._corridors};return Dungeon}(Term),Feature=function(){},Room=function(_Feature){function Room(x1,y1,x2,y2,doorX,doorY){var _this11=_Feature.call(this)||
this;_this11._x1=x1;_this11._y1=y1;_this11._x2=x2;_this11._y2=y2;_this11._doors={};void 0!==doorX&&void 0!==doorY&&_this11.addDoor(doorX,doorY);return _this11}_inheritsLoose(Room,_Feature);Room.createRandomAt=function(x,y,dx,dy,options){var min=options.roomWidth[0],max=options.roomWidth[1],width=RNG$1.getUniformInt(min,max);min=options.roomHeight[0];max=options.roomHeight[1];options=RNG$1.getUniformInt(min,max);if(1==dx)return dx=y-Math.floor(RNG$1.getUniform()*options),new this(x+1,dx,x+width,dx+
options-1,x,y);if(-1==dx)return dx=y-Math.floor(RNG$1.getUniform()*options),new this(x-width,dx,x-1,dx+options-1,x,y);if(1==dy)return dx=x-Math.floor(RNG$1.getUniform()*width),new this(dx,y+1,dx+width-1,y+options,x,y);if(-1==dy)return dx=x-Math.floor(RNG$1.getUniform()*width),new this(dx,y-options,dx+width-1,y-1,x,y);throw Error("dx or dy must be 1 or -1");};Room.createRandomCenter=function(cx,cy,options){var min=options.roomWidth[0],max=options.roomWidth[1],width=RNG$1.getUniformInt(min,max);min=
options.roomHeight[0];max=options.roomHeight[1];options=RNG$1.getUniformInt(min,max);cx-=Math.floor(RNG$1.getUniform()*width);cy-=Math.floor(RNG$1.getUniform()*options);return new this(cx,cy,cx+width-1,cy+options-1)};Room.createRandom=function(availWidth,availHeight,options){var min=options.roomWidth[0],max=options.roomWidth[1],width=RNG$1.getUniformInt(min,max);min=options.roomHeight[0];max=options.roomHeight[1];options=RNG$1.getUniformInt(min,max);availWidth=availWidth-width-1;availHeight=availHeight-
options-1;availWidth=1+Math.floor(RNG$1.getUniform()*availWidth);availHeight=1+Math.floor(RNG$1.getUniform()*availHeight);return new this(availWidth,availHeight,availWidth+width-1,availHeight+options-1)};var _proto23=Room.prototype;_proto23.addDoor=function(x,y){this._doors[x+","+y]=1;return this};_proto23.getDoors=function(cb){for(var key in this._doors){var parts=key.split(",");cb(parseInt(parts[0]),parseInt(parts[1]))}return this};_proto23.clearDoors=function(){this._doors={};return this};_proto23.addDoors=
function(isWallCallback){for(var left=this._x1-1,right=this._x2+1,top=this._y1-1,bottom=this._y2+1,x=left;x<=right;x++)for(var y=top;y<=bottom;y++)if(x==left||x==right||y==top||y==bottom)isWallCallback(x,y)||this.addDoor(x,y);return this};_proto23.debug=function(){console.log("room",this._x1,this._y1,this._x2,this._y2)};_proto23.isValid=function(isWallCallback,canBeDugCallback){for(var left=this._x1-1,right=this._x2+1,top=this._y1-1,bottom=this._y2+1,x=left;x<=right;x++)for(var y=top;y<=bottom;y++)if(x==
left||x==right||y==top||y==bottom){if(!isWallCallback(x,y))return!1}else if(!canBeDugCallback(x,y))return!1;return!0};_proto23.create=function(digCallback){for(var left=this._x1-1,right=this._x2+1,top=this._y1-1,bottom=this._y2+1,value,x=left;x<=right;x++)for(var y=top;y<=bottom;y++)value=x+","+y in this._doors?2:x==left||x==right||y==top||y==bottom?1:0,digCallback(x,y,value)};_proto23.getCenter=function(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]};_proto23.getLeft=
function(){return this._x1};_proto23.getRight=function(){return this._x2};_proto23.getTop=function(){return this._y1};_proto23.getBottom=function(){return this._y2};return Room}(Feature),Corridor=function(_Feature2){function Corridor(startX,startY,endX,endY){var _this12=_Feature2.call(this)||this;_this12._startX=startX;_this12._startY=startY;_this12._endX=endX;_this12._endY=endY;_this12._endsWithAWall=!0;return _this12}_inheritsLoose(Corridor,_Feature2);Corridor.createRandomAt=function(x,y,dx,dy,
options){options=RNG$1.getUniformInt(options.corridorLength[0],options.corridorLength[1]);return new this(x,y,x+dx*options,y+dy*options)};var _proto24=Corridor.prototype;_proto24.debug=function(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)};_proto24.isValid=function(isWallCallback,canBeDugCallback){var sx=this._startX,sy=this._startY,dx=this._endX-sx,dy=this._endY-sy,length=1+Math.max(Math.abs(dx),Math.abs(dy));dx&&(dx/=Math.abs(dx));dy&&(dy/=Math.abs(dy));for(var nx=dy,
ny=-dx,ok=!0,i=0;i<length;i++){var x=sx+i*dx,y=sy+i*dy;canBeDugCallback(x,y)||(ok=!1);isWallCallback(x+nx,y+ny)||(ok=!1);isWallCallback(x-nx,y-ny)||(ok=!1);if(!ok){length=i;this._endX=x-dx;this._endY=y-dy;break}}if(0==length||1==length&&isWallCallback(this._endX+dx,this._endY+dy))return!1;canBeDugCallback=!isWallCallback(this._endX+dx+nx,this._endY+dy+ny);nx=!isWallCallback(this._endX+dx-nx,this._endY+dy-ny);this._endsWithAWall=isWallCallback(this._endX+dx,this._endY+dy);return(canBeDugCallback||
nx)&&this._endsWithAWall?!1:!0};_proto24.create=function(digCallback){var sx=this._startX,sy=this._startY,dx=this._endX-sx,dy=this._endY-sy,length=1+Math.max(Math.abs(dx),Math.abs(dy));dx&&(dx/=Math.abs(dx));dy&&(dy/=Math.abs(dy));for(var i=0;i<length;i++)digCallback(sx+i*dx,sy+i*dy,0);return!0};_proto24.createPriorityWalls=function(priorityWallCallback){if(this._endsWithAWall){var dx=this._endX-this._startX,dy=this._endY-this._startY;dx&&(dx/=Math.abs(dx));dy&&(dy/=Math.abs(dy));var nx=dy,ny=-dx;
priorityWallCallback(this._endX+dx,this._endY+dy);priorityWallCallback(this._endX+nx,this._endY+ny);priorityWallCallback(this._endX-nx,this._endY-ny)}};return Corridor}(Feature);Feature=function(_Dungeon){function Uniform(width,height,options){width=_Dungeon.call(this,width,height)||this;width._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1E3};Object.assign(width._options,options);width._map=[];width._dug=0;width._roomAttempts=20;width._corridorAttempts=20;width._connected=
[];width._unconnected=[];width._digCallback=width._digCallback.bind(_assertThisInitialized(_assertThisInitialized(width)));width._canBeDugCallback=width._canBeDugCallback.bind(_assertThisInitialized(_assertThisInitialized(width)));width._isWallCallback=width._isWallCallback.bind(_assertThisInitialized(_assertThisInitialized(width)));return width}_inheritsLoose(Uniform,_Dungeon);var _proto25=Uniform.prototype;_proto25.create=function(callback){for(var t1=Date.now();;){if(Date.now()-t1>this._options.timeLimit)return null;
this._map=this._fillMap(1);this._dug=0;this._rooms=[];this._unconnected=[];this._generateRooms();if(!(2>this._rooms.length)&&this._generateCorridors())break}if(callback)for(t1=0;t1<this._width;t1++)for(var j=0;j<this._height;j++)callback(t1,j,this._map[t1][j]);return this};_proto25._generateRooms=function(){var w=this._width-2,h=this._height-2;do{var room=this._generateRoom();if(this._dug/(w*h)>this._options.roomDugPercentage)break}while(room)};_proto25._generateRoom=function(){for(var count=0;count<
this._roomAttempts;){count++;var room=Room.createRandom(this._width,this._height,this._options);if(room.isValid(this._isWallCallback,this._canBeDugCallback))return room.create(this._digCallback),this._rooms.push(room),room}return null};_proto25._generateCorridors=function(){for(var cnt=0;cnt<this._corridorAttempts;){cnt++;this._corridors=[];this._map=this._fillMap(1);for(var i=0;i<this._rooms.length;i++){var room=this._rooms[i];room.clearDoors();room.create(this._digCallback)}this._unconnected=RNG$1.shuffle(this._rooms.slice());
this._connected=[];for(this._unconnected.length&&this._connected.push(this._unconnected.pop());;){i=RNG$1.getItem(this._connected);if(!i)break;i=this._closestRoom(this._unconnected,i);if(!i)break;room=this._closestRoom(this._connected,i);if(!room)break;if(!this._connectRooms(i,room))break;if(!this._unconnected.length)return!0}}return!1};_proto25._closestRoom=function(rooms,room){var dist=Infinity;room=room.getCenter();for(var result=null,i=0;i<rooms.length;i++){var r=rooms[i],c=r.getCenter(),dx=c[0]-
room[0];c=c[1]-room[1];dx=dx*dx+c*c;dx<dist&&(dist=dx,result=r)}return result};_proto25._connectRooms=function(room1,room2){var center1=room1.getCenter(),center2=room2.getCenter(),diffX=center2[0]-center1[0];center1=center2[1]-center1[1];if(Math.abs(diffX)<Math.abs(center1)){diffX=0<center1?2:0;var dirIndex2=(diffX+2)%4;var min=room2.getLeft();var max=room2.getRight();center1=0}else diffX=0<diffX?1:3,dirIndex2=(diffX+2)%4,min=room2.getTop(),max=room2.getBottom(),center1=1;diffX=this._placeInWall(room1,
diffX);if(!diffX)return!1;if(diffX[center1]>=min&&diffX[center1]<=max){center2=diffX.slice();min=0;switch(dirIndex2){case 0:min=room2.getTop()-1;break;case 1:min=room2.getRight()+1;break;case 2:min=room2.getBottom()+1;break;case 3:min=room2.getLeft()-1}center2[(center1+1)%2]=min;this._digLine([diffX,center2])}else if(diffX[center1]<min-1||diffX[center1]>max+1){center2=diffX[center1]-center2[center1];min=0;switch(dirIndex2){case 0:case 1:min=0>center2?3:1;break;case 2:case 3:min=0>center2?1:3}center2=
this._placeInWall(room2,(dirIndex2+min)%4);if(!center2)return!1;dirIndex2=[0,0];dirIndex2[center1]=diffX[center1];center1=(center1+1)%2;dirIndex2[center1]=center2[center1];this._digLine([diffX,dirIndex2,center2])}else{min=(center1+1)%2;center2=this._placeInWall(room2,dirIndex2);if(!center2)return!1;dirIndex2=Math.round((center2[min]+diffX[min])/2);max=[0,0];var mid2=[0,0];max[center1]=diffX[center1];max[min]=dirIndex2;mid2[center1]=center2[center1];mid2[min]=dirIndex2;this._digLine([diffX,max,mid2,
center2])}room1.addDoor(diffX[0],diffX[1]);room2.addDoor(center2[0],center2[1]);center1=this._unconnected.indexOf(room1);-1!=center1&&(this._unconnected.splice(center1,1),this._connected.push(room1));center1=this._unconnected.indexOf(room2);-1!=center1&&(this._unconnected.splice(center1,1),this._connected.push(room2));return!0};_proto25._placeInWall=function(room,dirIndex){var start=[0,0],dir=[0,0],length=0;switch(dirIndex){case 0:dir=[1,0];start=[room.getLeft(),room.getTop()-1];length=room.getRight()-
room.getLeft()+1;break;case 1:dir=[0,1];start=[room.getRight()+1,room.getTop()];length=room.getBottom()-room.getTop()+1;break;case 2:dir=[1,0];start=[room.getLeft(),room.getBottom()+1];length=room.getRight()-room.getLeft()+1;break;case 3:dir=[0,1],start=[room.getLeft()-1,room.getTop()],length=room.getBottom()-room.getTop()+1}room=[];dirIndex=-2;for(var i=0;i<length;i++){var x=start[0]+i*dir[0],y=start[1]+i*dir[1];room.push(null);1==this._map[x][y]?dirIndex!=i-1&&(room[i]=[x,y]):(dirIndex=i)&&(room[i-
1]=null)}for(start=room.length-1;0<=start;start--)room[start]||room.splice(start,1);return room.length?RNG$1.getItem(room):null};_proto25._digLine=function(points){for(var i=1;i<points.length;i++){var start=points[i-1],end=points[i];start=new Corridor(start[0],start[1],end[0],end[1]);start.create(this._digCallback);this._corridors.push(start)}};_proto25._digCallback=function(x,y,value){this._map[x][y]=value;0==value&&this._dug++};_proto25._isWallCallback=function(x,y){return 0>x||0>y||x>=this._width||
y>=this._height?!1:1==this._map[x][y]};_proto25._canBeDugCallback=function(x,y){return 1>x||1>y||x+1>=this._width||y+1>=this._height?!1:1==this._map[x][y]};return Uniform}(Dungeon);var Cellular=function(_Map3){function Cellular(width,height,options){void 0===options&&(options={});width=_Map3.call(this,width,height)||this;width._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8};width.setOptions(options);width._dirs=DIRS[width._options.topology];width._map=width._fillMap(0);return width}_inheritsLoose(Cellular,
_Map3);var _proto26=Cellular.prototype;_proto26.randomize=function(probability){for(var i=0;i<this._width;i++)for(var j=0;j<this._height;j++)this._map[i][j]=RNG$1.getUniform()<probability?1:0;return this};_proto26.setOptions=function(options){Object.assign(this._options,options)};_proto26.set=function(x,y,value){this._map[x][y]=value};_proto26.create=function(callback){for(var newMap=this._fillMap(0),born=this._options.born,survive=this._options.survive,j=0;j<this._height;j++){var widthStep=1,widthStart=
0;6==this._options.topology&&(widthStep=2,widthStart=j%2);for(;widthStart<this._width;widthStart+=widthStep){var cur=this._map[widthStart][j],ncount=this._getNeighbors(widthStart,j);cur&&-1!=survive.indexOf(ncount)?newMap[widthStart][j]=1:cur||-1==born.indexOf(ncount)||(newMap[widthStart][j]=1)}}this._map=newMap;callback&&this._serviceCallback(callback)};_proto26._serviceCallback=function(callback){for(var j=0;j<this._height;j++){var widthStep=1,widthStart=0;6==this._options.topology&&(widthStep=
2,widthStart=j%2);for(;widthStart<this._width;widthStart+=widthStep)callback(widthStart,j,this._map[widthStart][j])}};_proto26._getNeighbors=function(cx,cy){for(var result=0,i=0;i<this._dirs.length;i++){var dir=this._dirs[i],x=cx+dir[0];dir=cy+dir[1];0>x||x>=this._width||0>dir||dir>=this._height||(result+=1==this._map[x][dir]?1:0)}return result};_proto26.connect=function(callback,value,connectionCallback){value||(value=0);var allFreeSpace=[],notConnected={},widthStep=1,widthStarts=[0,0];6==this._options.topology&&
(widthStep=2,widthStarts=[0,1]);for(var y=0;y<this._height;y++)for(var x=widthStarts[y%2];x<this._width;x+=widthStep)if(this._freeSpace(x,y,value)){var p=[x,y];notConnected[this._pointKey(p)]=p;allFreeSpace.push([x,y])}widthStep=allFreeSpace[RNG$1.getUniformInt(0,allFreeSpace.length-1)];widthStarts=this._pointKey(widthStep);allFreeSpace={};allFreeSpace[widthStarts]=widthStep;delete notConnected[widthStarts];for(this._findConnected(allFreeSpace,notConnected,[widthStep],!1,value);0<Object.keys(notConnected).length;){widthStarts=
this._getFromTo(allFreeSpace,notConnected);widthStep=widthStarts[0];y=widthStarts[1];widthStarts={};widthStarts[this._pointKey(widthStep)]=widthStep;this._findConnected(widthStarts,notConnected,[widthStep],!0,value);(6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected).call(this,y,widthStep,allFreeSpace,notConnected,value,connectionCallback);for(var k in widthStarts)widthStep=widthStarts[k],this._map[widthStep[0]][widthStep[1]]=value,allFreeSpace[k]=widthStep,delete notConnected[k]}callback&&
this._serviceCallback(callback)};_proto26._getFromTo=function(connected,notConnected){for(var from=[0,0],to=[0,0],d,connectedKeys=Object.keys(connected),notConnectedKeys=Object.keys(notConnected),i=0;5>i&&!(connectedKeys.length<notConnectedKeys.length?(from=connectedKeys,to=connected[from[RNG$1.getUniformInt(0,from.length-1)]],from=this._getClosest(to,notConnected)):(from=notConnectedKeys,from=notConnected[from[RNG$1.getUniformInt(0,from.length-1)]],to=this._getClosest(from,connected)),d=(from[0]-
to[0])*(from[0]-to[0])+(from[1]-to[1])*(from[1]-to[1]),64>d);i++);return[from,to]};_proto26._getClosest=function(point,space){var minPoint=null,minDist=null,k;for(k in space){var p=space[k],d=(p[0]-point[0])*(p[0]-point[0])+(p[1]-point[1])*(p[1]-point[1]);if(null==minDist||d<minDist)minDist=d,minPoint=p}return minPoint};_proto26._findConnected=function(connected,notConnected,stack,keepNotConnected,value){for(;0<stack.length;){var p=stack.splice(0,1)[0];p=6==this._options.topology?[[p[0]+2,p[1]],[p[0]+
1,p[1]-1],[p[0]-1,p[1]-1],[p[0]-2,p[1]],[p[0]-1,p[1]+1],[p[0]+1,p[1]+1]]:[[p[0]+1,p[1]],[p[0]-1,p[1]],[p[0],p[1]+1],[p[0],p[1]-1]];for(var i=0;i<p.length;i++){var key=this._pointKey(p[i]);null==connected[key]&&this._freeSpace(p[i][0],p[i][1],value)&&(connected[key]=p[i],keepNotConnected||delete notConnected[key],stack.push(p[i]))}}};_proto26._tunnelToConnected=function(to,from,connected,notConnected,value,connectionCallback){if(from[0]<to[0]){var a=from;var b=to}else a=to,b=from;for(var xx=a[0];xx<=
b[0];xx++){this._map[xx][a[1]]=value;var p=[xx,a[1]],pkey=this._pointKey(p);connected[pkey]=p;delete notConnected[pkey]}connectionCallback&&a[0]<b[0]&&connectionCallback(a,[b[0],a[1]]);xx=b[0];from[1]<to[1]?(a=from,b=to):(a=to,b=from);for(to=a[1];to<b[1];to++)this._map[xx][to]=value,from=[xx,to],p=this._pointKey(from),connected[p]=from,delete notConnected[p];connectionCallback&&a[1]<b[1]&&connectionCallback([b[0],a[1]],[b[0],b[1]])};_proto26._tunnelToConnected6=function(to,from,connected,notConnected,
value,connectionCallback){if(from[0]<to[0]){var a=from;var b=to}else a=to,b=from;var xx=a[0];for(a=a[1];xx!=b[0]||a!=b[1];){var stepWidth=2;a<b[1]?(a++,stepWidth=1):a>b[1]&&(a--,stepWidth=1);xx=xx<b[0]?xx+stepWidth:xx>b[0]?xx-stepWidth:b[1]%2?xx-stepWidth:xx+stepWidth;this._map[xx][a]=value;stepWidth=[xx,a];var pkey=this._pointKey(stepWidth);connected[pkey]=stepWidth;delete notConnected[pkey]}connectionCallback&&connectionCallback(from,to)};_proto26._freeSpace=function(x,y,value){return 0<=x&&x<this._width&&
0<=y&&y<this._height&&this._map[x][y]==value};_proto26._pointKey=function(p){return p[0]+"."+p[1]};return Cellular}(Term),FEATURES={room:Room,corridor:Corridor};Dungeon=function(_Dungeon2){function Digger(width,height,options){void 0===options&&(options={});width=_Dungeon2.call(this,width,height)||this;width._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1E3},options);width._features={room:4,corridor:4};width._map=[];width._featureAttempts=
20;width._walls={};width._dug=0;width._digCallback=width._digCallback.bind(_assertThisInitialized(_assertThisInitialized(width)));width._canBeDugCallback=width._canBeDugCallback.bind(_assertThisInitialized(_assertThisInitialized(width)));width._isWallCallback=width._isWallCallback.bind(_assertThisInitialized(_assertThisInitialized(width)));width._priorityWallCallback=width._priorityWallCallback.bind(_assertThisInitialized(_assertThisInitialized(width)));return width}_inheritsLoose(Digger,_Dungeon2);
var _proto27=Digger.prototype;_proto27.create=function(callback){this._rooms=[];this._corridors=[];this._map=this._fillMap(1);this._walls={};this._dug=0;var area=(this._width-2)*(this._height-2);this._firstRoom();var t1=Date.now();do{var priorityWalls=0;if(Date.now()-t1>this._options.timeLimit)break;var wall=this._findWall();if(!wall)break;var parts=wall.split(",");wall=parseInt(parts[0]);parts=parseInt(parts[1]);var dir=this._getDiggingDirection(wall,parts);if(dir){var featureAttempts=0;do if(featureAttempts++,
this._tryFeature(wall,parts,dir[0],dir[1])){this._removeSurroundingWalls(wall,parts);this._removeSurroundingWalls(wall-dir[0],parts-dir[1]);break}while(featureAttempts<this._featureAttempts);for(var id in this._walls)1<this._walls[id]&&priorityWalls++}}while(this._dug/area<this._options.dugPercentage||priorityWalls);this._addDoors();if(callback)for(area=0;area<this._width;area++)for(t1=0;t1<this._height;t1++)callback(area,t1,this._map[area][t1]);this._walls={};this._map=[];return this};_proto27._digCallback=
function(x,y,value){0==value||2==value?(this._map[x][y]=0,this._dug++):this._walls[x+","+y]=1};_proto27._isWallCallback=function(x,y){return 0>x||0>y||x>=this._width||y>=this._height?!1:1==this._map[x][y]};_proto27._canBeDugCallback=function(x,y){return 1>x||1>y||x+1>=this._width||y+1>=this._height?!1:1==this._map[x][y]};_proto27._priorityWallCallback=function(x,y){this._walls[x+","+y]=2};_proto27._firstRoom=function(){var room=Room.createRandomCenter(Math.floor(this._width/2),Math.floor(this._height/
2),this._options);this._rooms.push(room);room.create(this._digCallback)};_proto27._findWall=function(){var prio1=[],prio2=[],_id2;for(_id2 in this._walls)2==this._walls[_id2]?prio2.push(_id2):prio1.push(_id2);prio1=prio2.length?prio2:prio1;if(!prio1.length)return null;prio1=RNG$1.getItem(prio1.sort());delete this._walls[prio1];return prio1};_proto27._tryFeature=function(x,y,dx,dy){var featureName=RNG$1.getWeightedValue(this._features);x=FEATURES[featureName].createRandomAt(x,y,dx,dy,this._options);
if(!x.isValid(this._isWallCallback,this._canBeDugCallback))return!1;x.create(this._digCallback);x instanceof Room&&this._rooms.push(x);x instanceof Corridor&&(x.createPriorityWalls(this._priorityWallCallback),this._corridors.push(x));return!0};_proto27._removeSurroundingWalls=function(cx,cy){for(var deltas=DIRS[4],i=0;i<deltas.length;i++){var delta=deltas[i],x=cx+delta[0],y=cy+delta[1];delete this._walls[x+","+y];x=cx+2*delta[0];y=cy+2*delta[1];delete this._walls[x+","+y]}};_proto27._getDiggingDirection=
function(cx,cy){if(0>=cx||0>=cy||cx>=this._width-1||cy>=this._height-1)return null;for(var result=null,deltas=DIRS[4],i=0;i<deltas.length;i++){var delta=deltas[i];if(!this._map[cx+delta[0]][cy+delta[1]]){if(result)return null;result=delta}}return result?[-result[0],-result[1]]:null};_proto27._addDoors=function(){function isWallCallback(x,y){return 1==data[x][y]}for(var data=this._map,i=0;i<this._rooms.length;i++){var room=this._rooms[i];room.clearDoors();room.addDoors(isWallCallback)}};return Digger}(Dungeon);
var EllerMaze=function(_Map4){function EllerMaze(){return _Map4.apply(this,arguments)||this}_inheritsLoose(EllerMaze,_Map4);EllerMaze.prototype.create=function(callback){for(var map=this._fillMap(1),w=Math.ceil((this._width-2)/2),L=[],R=[],i=0;i<w;i++)L.push(i),R.push(i);L.push(w-1);for(i=1;i+3<this._height;i+=2)for(var _i4=0;_i4<w;_i4++){var x=2*_i4+1,y=i;map[x][y]=0;_i4!=L[_i4+1]&&.375<RNG$1.getUniform()&&(addToList(_i4,L,R),map[x+1][y]=0);_i4!=L[_i4]&&.375<RNG$1.getUniform()?removeFromList(_i4,
L,R):map[x][y+1]=0}for(_i4=0;_i4<w;_i4++)x=2*_i4+1,y=i,map[x][y]=0,_i4!=L[_i4+1]&&(_i4==L[_i4]||.375<RNG$1.getUniform())&&(addToList(_i4,L,R),map[x+1][y]=0),removeFromList(_i4,L,R);for(w=0;w<this._width;w++)for(L=0;L<this._height;L++)callback(w,L,map[w][L]);return this};return EllerMaze}(Term),DividedMaze=function(_Map5){function DividedMaze(){var _this16=_Map5.apply(this,arguments)||this;_this16._stack=[];_this16._map=[];return _this16}_inheritsLoose(DividedMaze,_Map5);var _proto29=DividedMaze.prototype;
_proto29.create=function(callback){var w=this._width,h=this._height;this._map=[];for(var i=0;i<w;i++){this._map.push([]);for(var j=0;j<h;j++)this._map[i].push(0==i||0==j||i+1==w||j+1==h?1:0)}this._stack=[[1,1,w-2,h-2]];this._process();for(i=0;i<w;i++)for(j=0;j<h;j++)callback(i,j,this._map[i][j]);this._map=[];return this};_proto29._process=function(){for(;this._stack.length;){var room=this._stack.shift();this._partitionRoom(room)}};_proto29._partitionRoom=function(room){for(var availX=[],availY=[],
i=room[0]+1;i<room[2];i++){var bottom=this._map[i][room[3]+1];!this._map[i][room[1]-1]||!bottom||i%2||availX.push(i)}for(i=room[1]+1;i<room[3];i++)bottom=this._map[room[2]+1][i],!this._map[room[0]-1][i]||!bottom||i%2||availY.push(i);if(availX.length&&availY.length){availX=RNG$1.getItem(availX);availY=RNG$1.getItem(availY);this._map[availX][availY]=1;i=[];bottom=[];i.push(bottom);for(var _i8=room[0];_i8<availX;_i8++)this._map[_i8][availY]=1,bottom.push([_i8,availY]);bottom=[];i.push(bottom);for(_i8=
availX+1;_i8<=room[2];_i8++)this._map[_i8][availY]=1,bottom.push([_i8,availY]);bottom=[];i.push(bottom);for(_i8=room[1];_i8<availY;_i8++)this._map[availX][_i8]=1,bottom.push([availX,_i8]);bottom=[];i.push(bottom);for(_i8=availY+1;_i8<=room[3];_i8++)this._map[availX][_i8]=1,bottom.push([availX,_i8]);bottom=RNG$1.getItem(i);for(_i8=0;_i8<i.length;_i8++){var _w=i[_i8];_w!=bottom&&(_w=RNG$1.getItem(_w),this._map[_w[0]][_w[1]]=0)}this._stack.push([room[0],room[1],availX-1,availY-1]);this._stack.push([availX+
1,room[1],room[2],availY-1]);this._stack.push([room[0],availY+1,availX-1,room[3]]);this._stack.push([availX+1,availY+1,room[2],room[3]])}};return DividedMaze}(Term),IceyMaze=function(_Map6){function IceyMaze(width,height,regularity){void 0===regularity&&(regularity=0);width=_Map6.call(this,width,height)||this;width._regularity=regularity;width._map=[];return width}_inheritsLoose(IceyMaze,_Map6);var _proto30=IceyMaze.prototype;_proto30.create=function(callback){var width=this._width,height=this._height,
map=this._fillMap(1);width-=width%2?1:2;height-=height%2?1:2;var done=0,dirs=[[0,0],[0,0],[0,0],[0,0]];do{var cx=1+2*Math.floor(RNG$1.getUniform()*(width-1)/2);var cy=1+2*Math.floor(RNG$1.getUniform()*(height-1)/2);done||(map[cx][cy]=0);if(!map[cx][cy]){this._randomize(dirs);do{0==Math.floor(RNG$1.getUniform()*(this._regularity+1))&&this._randomize(dirs);var blocked=!0;for(var i=0;4>i;i++){var nx=cx+2*dirs[i][0];var ny=cy+2*dirs[i][1];if(this._isFree(map,nx,ny,width,height)){map[nx][ny]=0;map[cx+
dirs[i][0]][cy+dirs[i][1]]=0;cx=nx;cy=ny;blocked=!1;done++;break}}}while(!blocked)}}while(done+1<width*height/4);for(width=0;width<this._width;width++)for(height=0;height<this._height;height++)callback(width,height,map[width][height]);this._map=[];return this};_proto30._randomize=function(dirs){for(var i=0;4>i;i++)dirs[i][0]=0,dirs[i][1]=0;switch(Math.floor(4*RNG$1.getUniform())){case 0:dirs[0][0]=-1;dirs[1][0]=1;dirs[2][1]=-1;dirs[3][1]=1;break;case 1:dirs[3][0]=-1;dirs[2][0]=1;dirs[1][1]=-1;dirs[0][1]=
1;break;case 2:dirs[2][0]=-1;dirs[3][0]=1;dirs[0][1]=-1;dirs[1][1]=1;break;case 3:dirs[1][0]=-1,dirs[0][0]=1,dirs[3][1]=-1,dirs[2][1]=1}};_proto30._isFree=function(map,x,y,width,height){return 1>x||1>y||x>=width||y>=height?!1:map[x][y]};return IceyMaze}(Term);Term=function(_Map7){function Rogue(width,height,options){width=_Map7.call(this,width,height)||this;width.map=[];width.rooms=[];width.connectedCells=[];options=Object.assign({cellWidth:3,cellHeight:3},options);options.hasOwnProperty("roomWidth")||
(options.roomWidth=width._calculateRoomSize(width._width,options.cellWidth));options.hasOwnProperty("roomHeight")||(options.roomHeight=width._calculateRoomSize(width._height,options.cellHeight));width._options=options;return width}_inheritsLoose(Rogue,_Map7);var _proto31=Rogue.prototype;_proto31.create=function(callback){this.map=this._fillMap(1);this.rooms=[];this.connectedCells=[];this._initRooms();this._connectRooms();this._connectUnconnectedRooms();this._createRandomRoomConnections();this._createRooms();
this._createCorridors();if(callback)for(var i=0;i<this._width;i++)for(var j=0;j<this._height;j++)callback(i,j,this.map[i][j]);return this};_proto31._calculateRoomSize=function(size,cell){var max=Math.floor(size/cell*.8);size=Math.floor(size/cell*.25);2>size&&(size=2);2>max&&(max=2);return[size,max]};_proto31._initRooms=function(){for(var i=0;i<this._options.cellWidth;i++){this.rooms.push([]);for(var j=0;j<this._options.cellHeight;j++)this.rooms[i].push({x:0,y:0,width:0,height:0,connections:[],cellx:i,
celly:j})}};_proto31._connectRooms=function(){var cgx=RNG$1.getUniformInt(0,this._options.cellWidth-1),cgy=RNG$1.getUniformInt(0,this._options.cellHeight-1);do{var dirToCheck=[0,2,4,6];dirToCheck=RNG$1.shuffle(dirToCheck);do{var found=!1;var idx=dirToCheck.pop();var ncgx=cgx+DIRS[8][idx][0];idx=cgy+DIRS[8][idx][1];if(!(0>ncgx||ncgx>=this._options.cellWidth||0>idx||idx>=this._options.cellHeight)){var room=this.rooms[cgx][cgy];if(0<room.connections.length&&room.connections[0][0]==ncgx&&room.connections[0][1]==
idx)break;room=this.rooms[ncgx][idx];0==room.connections.length&&(room.connections.push([cgx,cgy]),this.connectedCells.push([ncgx,idx]),cgx=ncgx,cgy=idx,found=!0)}}while(0<dirToCheck.length&&0==found)}while(0<dirToCheck.length)};_proto31._connectUnconnectedRooms=function(){var cw=this._options.cellWidth,ch=this._options.cellHeight;this.connectedCells=RNG$1.shuffle(this.connectedCells);for(var room,otherRoom,validRoom,i=0;i<this._options.cellWidth;i++)for(var j=0;j<this._options.cellHeight;j++)if(room=
this.rooms[i][j],0==room.connections.length){var directions=[0,2,4,6];directions=RNG$1.shuffle(directions);validRoom=!1;do{var dirIdx=directions.pop(),newI=i+DIRS[8][dirIdx][0];dirIdx=j+DIRS[8][dirIdx][1];if(!(0>newI||newI>=cw||0>dirIdx||dirIdx>=ch)){otherRoom=this.rooms[newI][dirIdx];validRoom=!0;if(0==otherRoom.connections.length)break;for(newI=0;newI<otherRoom.connections.length;newI++)if(otherRoom.connections[newI][0]==i&&otherRoom.connections[newI][1]==j){validRoom=!1;break}if(validRoom)break}}while(directions.length);
validRoom?room.connections.push([otherRoom.cellx,otherRoom.celly]):console.log("-- Unable to connect room.")}};_proto31._createRandomRoomConnections=function(){};_proto31._createRooms=function(){for(var w=this._width,h=this._height,cw=this._options.cellWidth,ch=this._options.cellHeight,cwp=Math.floor(this._width/cw),chp=Math.floor(this._height/ch),roomw,roomh,roomWidth=this._options.roomWidth,roomHeight=this._options.roomHeight,sx,sy,otherRoom,i=0;i<cw;i++)for(var j=0;j<ch;j++){sx=cwp*i;sy=chp*j;
0==sx&&(sx=1);0==sy&&(sy=1);roomw=RNG$1.getUniformInt(roomWidth[0],roomWidth[1]);roomh=RNG$1.getUniformInt(roomHeight[0],roomHeight[1]);if(0<j)for(otherRoom=this.rooms[i][j-1];3>sy-(otherRoom.y+otherRoom.height);)sy++;if(0<i)for(otherRoom=this.rooms[i-1][j];3>sx-(otherRoom.x+otherRoom.width);)sx++;otherRoom=Math.round(RNG$1.getUniformInt(0,cwp-roomw)/2);for(var syOffset=Math.round(RNG$1.getUniformInt(0,chp-roomh)/2);sx+otherRoom+roomw>=w;)otherRoom?otherRoom--:roomw--;for(;sy+syOffset+roomh>=h;)syOffset?
syOffset--:roomh--;sx+=otherRoom;sy+=syOffset;this.rooms[i][j].x=sx;this.rooms[i][j].y=sy;this.rooms[i][j].width=roomw;this.rooms[i][j].height=roomh;for(otherRoom=sx;otherRoom<sx+roomw;otherRoom++)for(syOffset=sy;syOffset<sy+roomh;syOffset++)this.map[otherRoom][syOffset]=0}};_proto31._getWallPosition=function(aRoom,aDirection){if(1==aDirection||3==aDirection){var rx=RNG$1.getUniformInt(aRoom.x+1,aRoom.x+aRoom.width-2);if(1==aDirection){var ry=aRoom.y-2;aRoom=ry+1}else ry=aRoom.y+aRoom.height+1,aRoom=
ry-1;this.map[rx][aRoom]=0}else ry=RNG$1.getUniformInt(aRoom.y+1,aRoom.y+aRoom.height-2),2==aDirection?(rx=aRoom.x+aRoom.width+1,aRoom=rx-1):(rx=aRoom.x-2,aRoom=rx+1),this.map[aRoom][ry]=0;return[rx,ry]};_proto31._drawCorridor=function(startPosition,endPosition){var xOffset=endPosition[0]-startPosition[0],yOffset=endPosition[1]-startPosition[1];endPosition=startPosition[0];startPosition=startPosition[1];var moves=[];var move=Math.abs(xOffset);var yAbs=Math.abs(yOffset);var tempDist=RNG$1.getUniform();
var secondHalf=1-tempDist;xOffset=0<xOffset?2:6;yOffset=0<yOffset?4:0;move<yAbs?(tempDist=Math.ceil(yAbs*tempDist),moves.push([yOffset,tempDist]),moves.push([xOffset,move]),tempDist=Math.floor(yAbs*secondHalf),moves.push([yOffset,tempDist])):(tempDist=Math.ceil(move*tempDist),moves.push([xOffset,tempDist]),moves.push([yOffset,yAbs]),tempDist=Math.floor(move*secondHalf),moves.push([xOffset,tempDist]));for(this.map[endPosition][startPosition]=0;0<moves.length;)for(move=moves.pop();0<move[1];)endPosition+=
DIRS[8][move[0]][0],startPosition+=DIRS[8][move[0]][1],this.map[endPosition][startPosition]=0,--move[1]};_proto31._createCorridors=function(){for(var cw=this._options.cellWidth,ch=this._options.cellHeight,room,connection,wall,otherWall,i=0;i<cw;i++)for(var j=0;j<ch;j++){room=this.rooms[i][j];for(var k=0;k<room.connections.length;k++)connection=room.connections[k],connection=this.rooms[connection[0]][connection[1]],connection.cellx>room.cellx?(wall=2,otherWall=4):connection.cellx<room.cellx?(wall=
4,otherWall=2):connection.celly>room.celly?(wall=3,otherWall=1):(wall=1,otherWall=3),this._drawCorridor(this._getWallPosition(room,wall),this._getWallPosition(connection,otherWall))}};return Rogue}(Term);TileGL={Arena:TileGL,Uniform:Feature,Cellular:Cellular,Digger:Dungeon,EllerMaze:EllerMaze,DividedMaze:DividedMaze,IceyMaze:IceyMaze,Rogue:Term};var F2=.5*(Math.sqrt(3)-1),G2=(3-Math.sqrt(3))/6;Term={Simplex:function(_Noise){function Simplex(gradients){void 0===gradients&&(gradients=256);var _this19=
_Noise.call(this)||this;_this19._gradients=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];for(var permutations=[],i=0;i<gradients;i++)permutations.push(i);permutations=RNG$1.shuffle(permutations);_this19._perms=[];_this19._indexes=[];for(i=0;i<2*gradients;i++)_this19._perms.push(permutations[i%gradients]),_this19._indexes.push(_this19._perms[i]%_this19._gradients.length);return _this19}_inheritsLoose(Simplex,_Noise);Simplex.prototype.get=function(xin,yin){var perms=this._perms,indexes=this._indexes,
count=perms.length/2,n0=0,n1=0,n2=0,s=(xin+yin)*F2,i=Math.floor(xin+s);var gi=Math.floor(yin+s);var t=(i+gi)*G2;s=xin-(i-t);var y0=yin-(gi-t);if(s>y0){var i1=1;var j1=0}else i1=0,j1=1;t=s-i1+G2;var y1=y0-j1+G2;yin=s-1+2*G2;xin=y0-1+2*G2;i=mod(i,count);count=mod(gi,count);var t0=.5-s*s-y0*y0;0<=t0&&(t0*=t0,gi=indexes[i+perms[count]],n0=this._gradients[gi],n0=t0*t0*(n0[0]*s+n0[1]*y0));s=.5-t*t-y1*y1;0<=s&&(s*=s,gi=indexes[i+i1+perms[count+j1]],n1=this._gradients[gi],n1=s*s*(n1[0]*t+n1[1]*y1));s=.5-
yin*yin-xin*xin;0<=s&&(s*=s,gi=indexes[i+1+perms[count+1]],perms=this._gradients[gi],n2=s*s*(perms[0]*yin+perms[1]*xin));return 70*(n0+n1+n2)};return Simplex}(function(){})};Cellular=function(){function Path(toX,toY,passableCallback,options){void 0===options&&(options={});this._toX=toX;this._toY=toY;this._passableCallback=passableCallback;this._options=Object.assign({topology:8},options);this._dirs=DIRS[this._options.topology];8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],
this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])}Path.prototype._getNeighbors=function(cx,cy){for(var result=[],i=0;i<this._dirs.length;i++){var dir=this._dirs[i],x=cx+dir[0];dir=cy+dir[1];this._passableCallback(x,dir)&&result.push([x,dir])}return result};return Path}();Feature=function(_Path){function Dijkstra(toX,toY,passableCallback,options){passableCallback=_Path.call(this,toX,toY,passableCallback,options)||this;passableCallback._computed={};passableCallback._todo=[];passableCallback._add(toX,
toY,null);return passableCallback}_inheritsLoose(Dijkstra,_Path);var _proto34=Dijkstra.prototype;_proto34.compute=function(fromX,fromY,callback){var key=fromX+","+fromY;key in this._computed||this._compute(fromX,fromY);if(key in this._computed)for(fromX=this._computed[key];fromX;)callback(fromX.x,fromX.y),fromX=fromX.prev};_proto34._compute=function(fromX,fromY){for(;this._todo.length;){var item=this._todo.shift();if(item.x==fromX&&item.y==fromY)break;for(var neighbors=this._getNeighbors(item.x,item.y),
i=0;i<neighbors.length;i++){var neighbor=neighbors[i],x=neighbor[0];neighbor=neighbor[1];x+","+neighbor in this._computed||this._add(x,neighbor,item)}}};_proto34._add=function(x,y,prev){prev={x:x,y:y,prev:prev};this._computed[x+","+y]=prev;this._todo.push(prev)};return Dijkstra}(Cellular);Cellular=function(_Path2){function AStar(toX,toY,passableCallback,options){void 0===options&&(options={});toX=_Path2.call(this,toX,toY,passableCallback,options)||this;toX._todo=[];toX._done={};return toX}_inheritsLoose(AStar,
_Path2);var _proto35=AStar.prototype;_proto35.compute=function(fromX,fromY,callback){this._todo=[];this._done={};this._fromX=fromX;this._fromY=fromY;for(this._add(this._toX,this._toY,null);this._todo.length;){var _item=this._todo.shift(),id=_item.x+","+_item.y;if(!(id in this._done)){this._done[id]=_item;if(_item.x==fromX&&_item.y==fromY)break;id=this._getNeighbors(_item.x,_item.y);for(var i=0;i<id.length;i++){var neighbor=id[i],x=neighbor[0];neighbor=neighbor[1];x+","+neighbor in this._done||this._add(x,
neighbor,_item)}}}if(fromX=this._done[fromX+","+fromY])for(;fromX;)callback(fromX.x,fromX.y),fromX=fromX.prev};_proto35._add=function(x,y,prev){var h=this._distance(x,y);x={x:x,y:y,prev:prev,g:prev?prev.g+1:0,h:h};y=x.g+x.h;for(prev=0;prev<this._todo.length;prev++){var item=this._todo[prev],itemF=item.g+item.h;if(y<itemF||y==itemF&&h<item.h){this._todo.splice(prev,0,x);return}}this._todo.push(x)};_proto35._distance=function(x,y){switch(this._options.topology){case 4:return Math.abs(x-this._fromX)+
Math.abs(y-this._fromY);case 6:return y=Math.abs(y-this._fromY),y+Math.max(0,(Math.abs(x-this._fromX)-y)/2);case 8:return Math.max(Math.abs(x-this._fromX),Math.abs(y-this._fromY))}};return AStar}(Cellular);Feature={Dijkstra:Feature,AStar:Cellular};Cellular=function(){function Engine(scheduler){this._scheduler=scheduler;this._lock=1}var _proto36=Engine.prototype;_proto36.start=function(){return this.unlock()};_proto36.lock=function(){this._lock++;return this};_proto36.unlock=function(){if(!this._lock)throw Error("Cannot unlock unlocked engine");
for(this._lock--;!this._lock;){var actor=this._scheduler.next();if(!actor)return this.lock();(actor=actor.act())&&actor.then&&(this.lock(),actor.then(this.unlock.bind(this)))}return this};return Engine}();Dungeon=function(){function Lighting(reflectivityCallback,options){void 0===options&&(options={});this._reflectivityCallback=reflectivityCallback;this._options={};options=Object.assign({passes:1,emissionThreshold:100,range:10},options);this._lights={};this._reflectivityCache={};this._fovCache={};
this.setOptions(options)}var _proto37=Lighting.prototype;_proto37.setOptions=function(options){Object.assign(this._options,options);options&&options.range&&this.reset();return this};_proto37.setFOV=function(fov){this._fov=fov;this._fovCache={};return this};_proto37.setLight=function(x,y,color){x=x+","+y;color?this._lights[x]="string"==typeof color?fromString(color):color:delete this._lights[x];return this};_proto37.clearLights=function(){this._lights={}};_proto37.reset=function(){this._reflectivityCache=
{};this._fovCache={};return this};_proto37.compute=function(lightingCallback){var doneCells={},emittingCells={},litCells={},key;for(key in this._lights){var light=this._lights[key];emittingCells[key]=[0,0,0];add_(emittingCells[key],light)}for(key=0;key<this._options.passes;key++)this._emitLight(emittingCells,litCells,doneCells),key+1!=this._options.passes&&(emittingCells=this._computeEmitters(litCells,doneCells));for(var litKey in litCells)emittingCells=litKey.split(","),doneCells=parseInt(emittingCells[0]),
emittingCells=parseInt(emittingCells[1]),lightingCallback(doneCells,emittingCells,litCells[litKey]);return this};_proto37._emitLight=function(emittingCells,litCells,doneCells){for(var key in emittingCells){var parts=key.split(","),x=parseInt(parts[0]);parts=parseInt(parts[1]);this._emitLightFromCell(x,parts,emittingCells[key],litCells);doneCells[key]=1}return this};_proto37._computeEmitters=function(litCells,doneCells){var result={},key;for(key in litCells)if(!(key in doneCells)){var _color=litCells[key];
if(key in this._reflectivityCache)var reflectivity=this._reflectivityCache[key];else{var parts=key.split(",");reflectivity=parseInt(parts[0]);parts=parseInt(parts[1]);reflectivity=this._reflectivityCallback(reflectivity,parts);this._reflectivityCache[key]=reflectivity}if(0!=reflectivity){parts=[0,0,0];for(var intensity=0,i=0;3>i;i++){var part=Math.round(_color[i]*reflectivity);parts[i]=part;intensity+=part}intensity>this._options.emissionThreshold&&(result[key]=parts)}}return result};_proto37._emitLightFromCell=
function(x,y,color,litCells){var key=x+","+y;x=key in this._fovCache?this._fovCache[key]:this._updateFOV(x,y);for(var fovKey in x){y=x[fovKey];fovKey in litCells?key=litCells[fovKey]:(key=[0,0,0],litCells[fovKey]=key);for(var i=0;3>i;i++)key[i]+=Math.round(color[i]*y)}return this};_proto37._updateFOV=function(x$jscomp$0,y$jscomp$0){var cache={};this._fovCache[x$jscomp$0+","+y$jscomp$0]=cache;var range=this._options.range;this._fov.compute(x$jscomp$0,y$jscomp$0,range,function(x,y,r,vis){r=vis*(1-r/
range);0!=r&&(cache[x+","+y]=r)}.bind(this));return cache};return Lighting}();exports.Util=util;exports.Color=Canvas;exports.Text=Backend;exports.RNG=RNG$1;exports.Display=Display;exports.StringGenerator=Hex;exports.EventQueue=EventQueue;exports.Scheduler=Rect$jscomp$0;exports.FOV=Tile;exports.Map=TileGL;exports.Noise=Term;exports.Path=Feature;exports.Engine=Cellular;exports.Lighting=Dungeon;exports.DEFAULT_WIDTH=80;exports.DEFAULT_HEIGHT=25;exports.DIRS=DIRS;exports.KEYS={VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,
VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,
VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,
VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,
VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95};Object.defineProperty(exports,"__esModule",{value:!0})})}
//# sourceMappingURL=module$node_modules$rot_js$dist$rot.js.map
